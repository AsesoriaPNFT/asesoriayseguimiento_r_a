<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Asesor√≠a Tecnolog√≠a Educativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Scrollbar personalizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-slate-800 h-screen flex overflow-hidden">

    <aside class="w-72 bg-white border-r border-slate-200 flex-shrink-0 flex flex-col h-full z-20 hidden md:flex shadow-xl">
        <div class="p-8 border-b border-slate-100 bg-slate-50">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-xl shadow-lg shadow-indigo-200">
                    <i class="ph-bold ph-cube text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="font-black text-lg tracking-tight text-slate-800">Asesor√≠a PNFT</h1>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Dimensi√≥n 1</p>
                </div>
            </div>
        </div>
        
        <nav class="flex-1 overflow-y-auto p-4 space-y-1" id="sidebar-nav">
            </nav>

        <div class="p-4 border-t border-slate-100 bg-slate-50">
            <div class="bg-white border border-slate-200 rounded-xl p-3 shadow-sm flex items-center gap-3">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <div class="flex-1 min-w-0">
                    <p class="text-xs font-bold text-slate-700 truncate" id="auth-status">Cargando...</p>
                    <p class="text-[10px] text-slate-400">Sistema Activo</p>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full relative overflow-hidden bg-slate-50/50">
        <header class="md:hidden bg-white border-b border-slate-200 p-4 flex justify-between items-center z-10 sticky top-0">
            <h1 class="font-bold text-slate-700">Portal Asesor√≠a</h1>
            <button onclick="document.querySelector('aside').classList.toggle('hidden'); document.querySelector('aside').classList.toggle('absolute'); document.querySelector('aside').classList.toggle('h-full');" class="p-2 text-slate-600"><i class="ph-bold ph-list text-2xl"></i></button>
        </header>

        <div id="app-content" class="flex-1 overflow-y-auto p-4 md:p-10 fade-in relative">
            </div>
    </main>

    <div id="auth-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-teal-400 to-indigo-500"></div>
            <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i class="ph-bold ph-x text-xl"></i></button>
            
            <div class="text-center mb-8">
                <div class="bg-indigo-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ph-bold ph-fingerprint text-3xl text-indigo-600"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-800">Identificaci√≥n</h3>
                <p class="text-slate-500 text-sm mt-2">Acceso exclusivo para docentes MEP.</p>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1 ml-1">Correo Oficial</label>
                    <div class="relative">
                        <i class="ph-bold ph-envelope absolute left-4 top-3.5 text-slate-400"></i>
                        <input type="email" id="auth-email" placeholder="nombre.apellido@mep.go.cr" class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-indigo-500 font-medium transition-all text-sm">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1 ml-1">Contrase√±a</label>
                    <div class="relative">
                        <i class="ph-bold ph-lock-key absolute left-4 top-3.5 text-slate-400"></i>
                        <input type="password" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-indigo-500 font-medium transition-all text-sm">
                    </div>
                </div>
                <button onclick="handleAuth('login')" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold shadow-lg shadow-slate-200 hover:bg-black transition-transform active:scale-95 mt-2">Ingresar</button>
                <button onclick="handleAuth('register')" class="w-full bg-white text-slate-600 py-3 rounded-xl font-bold border border-slate-200 hover:bg-slate-50 transition-colors text-sm">Crear cuenta nueva</button>
            </div>
        </div>
    </div>

    <div id="forum-modal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-2xl">
            <h3 class="text-2xl font-black mb-6">Nueva Publicaci√≥n</h3>
            <input type="text" id="post-title" placeholder="T√≠tulo del tema..." class="w-full p-4 bg-slate-50 border rounded-xl mb-4 font-bold outline-none focus:border-blue-500">
            <select id="post-tag" class="w-full p-4 bg-slate-50 border rounded-xl mb-4 font-bold text-slate-600 outline-none">
                <option value="Duda General">ü§î Duda General</option>
                <option value="Material Did√°ctico">üìö Material Did√°ctico</option>
                <option value="Experiencia">üí° Experiencia Exitosa</option>
            </select>
            <textarea id="post-content" class="w-full p-4 bg-slate-50 border rounded-xl mb-6 h-32 resize-none outline-none focus:border-blue-500" placeholder="Escribe tu consulta o aporte..."></textarea>
            <div class="flex justify-end gap-3">
                <button onclick="closeForumModal()" class="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100">Cancelar</button>
                <button onclick="savePost()" class="px-6 py-3 rounded-xl font-bold bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-200">Publicar</button>
            </div>
        </div>
    </div>

    <div id="reply-modal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-lg">
            <h3 class="text-xl font-black mb-4 text-indigo-800">Respuesta Oficial</h3>
            <input type="hidden" id="reply-post-id">
            <textarea id="reply-content" class="w-full p-4 bg-indigo-50 border border-indigo-100 rounded-xl mb-6 h-32 resize-none outline-none focus:border-indigo-500" placeholder="Escribe la respuesta oficial..."></textarea>
            <div class="flex justify-end gap-3">
                <button onclick="closeReplyModal()" class="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100">Cancelar</button>
                <button onclick="saveReply()" class="px-6 py-3 rounded-xl font-bold bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg">Enviar Respuesta</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, getDoc, setDoc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- 1. CONFIGURACI√ìN ---
        // Aqu√≠ no tocamos la API Key de Firebase, esa est√° bien.
        const firebaseConfig = {
            apiKey: "AIzaSyBABrNvQH1Zu-peF3Rn1uCe-Yfb2LBGC9A",
            authDomain: "asesoriayseguimiento2026.firebaseapp.com",
            projectId: "asesoriayseguimiento2026",
            storageBucket: "asesoriayseguimiento2026.firebasestorage.app",
            messagingSenderId: "800061887135",
            appId: "1:800061887135:web:f096970be5c69a465988aa"
        };
        
        const appId = 'asesoriayseguimiento2026';
        const MODEL_NAME = "gemini-1.5-flash"; 
        const ADVISOR_EMAILS = ["alberto.bustos.ortega@mep.go.cr", "rodolfo.juarez.perez@mep.go.cr"];

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Estado Global
        window.state = { view: 'dashboard', user: null, advisor: false, posts: [], institutions: [], accessLogs: [], guideLevel: '7', guideTab: 'curriculum' };

        // --- DATOS EST√ÅTICOS ---
        const TEACHER_GUIDE_DATA = {
            pillars: ["Apropiaci√≥n Tecnol√≥gica y Digital", "Programaci√≥n y Algoritmos", "Computaci√≥n F√≠sica y Rob√≥tica", "Ciencia de Datos e Inteligencia Artificial"],
            axes: ["Pensamiento Computacional", "Ciudadan√≠a y √âtica Digital", "Emprendimiento e Innovaci√≥n"],
            knowledgeTypes: ["Conceptuales: El 'saber' (temas t√©cnicos).", "Procedimentales: El 'saber hacer' (abstraer, depurar, programar).", "Actitudinales: El 'ser' (tolerancia a la frustraci√≥n, precisi√≥n y √©tica)."],
            levels: {
                "7": { title: "S√©timo A√±o: Fundamentos y L√≥gica", modules: [{ name: "M√≥dulo 1: Apropiaci√≥n y L√≥gica", topics: ["Computadora", "Hardware y Software", "Redes de comunicaci√≥n", "Sistema Operativo", "Gesti√≥n de archivos", "Herramientas de productividad", "Algoritmo", "Tablas de Verdad", "Estructuras condicionales", "Operadores aritm
