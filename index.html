// --- BASE DE DATOS CURRICULAR 2026 (Inyectada de archivos adjuntos) ---
const CURRICULUM_2026 = {
    "7": {
        modulos: ["Módulo 1: Lógica y Apropiación", "Módulo 2: Ciudadanía Digital"],
        indicadores_logro: ["Identifica componentes de hardware", "Aplica netiqueta en entornos virtuales"] // Extraídos de tus docs
    },
    "8": {
        modulos: ["Módulo 1: Mecanismos y Robótica", "Módulo 2: IoT y Datos"],
        indicadores_logro: ["Construye circuitos básicos", "Analiza flujos de datos en sensores"]
    },
    "9": {
        modulos: ["Módulo 1: Automatización", "Módulo 2: Ética e IA"],
        indicadores_logro: ["Diseña prototipos domóticos", "Evalúa sesgos en algoritmos de IA"]
    }
};

// --- FIRMA DINÁMICA SEGÚN ASESOR ---
const ASESORES_INFO = {
    "alberto.bustos.ortega@mep.go.cr": { nombre: "Alberto José Bustos Ortega", cargo: "Asesor Nacional de Recursos Tecnológicos en Educación" },
    "rodolfo.juarez.perez@mep.go.cr": { nombre: "Rodolfo Juárez Pérez", cargo: "Asesor Nacional de Recursos Tecnológicos en Educación" }
};

// --- MEJORA: GENERADOR DE INDICADORES TÉCNICOS ---
window.generateEvaluationIndicators = async () => {
    const nivel = window.state.guideLevel;
    const modulo = document.getElementById('selected-module').value;
    const r = document.getElementById('ind-results');
    
    r.innerHTML = "✨ Transformando Indicadores de Logro en Evaluación (Fórmula Acción+Contenido+Condición)...";

    // Enviamos el contexto de los documentos a la IA
    const prompt = `Basado en la Guía Docente 2026 para ${nivel}° año, toma los indicadores de logro del ${modulo} y conviértelos en 3 Indicadores de Evaluación. 
    REGLA: Deben tener un Verbo Observable, el Contenido Técnico y la Condición de ejecución.`;

    const docRef = await addDoc(collection(db, "docentes", auth.currentUser.uid, "consultas_ia"), {
        prompt: prompt,
        timestamp: Date.now()
    });

    onSnapshot(doc(db, "docentes", auth.currentUser.uid, "consultas_ia", docRef.id), (snap) => {
        if (snap.data()?.response) {
            r.innerHTML = `<div id="pdf-ind" class="glass p-6 rounded-2xl text-slate-300">${snap.data().response.replace(/\n/g, '<br>')}</div>
            <button onclick="downloadPDF('pdf-ind', 'Indicadores_Evaluacion_2026')" class="mt-4 bg-teal-500 text-slate-900 px-4 py-2 rounded-xl font-bold text-xs">Descargar PDF</button>`;
        }
    });
};
